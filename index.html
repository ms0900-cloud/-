# Save the full HTML with all required behavior to a file
html_code = """
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>행동경제학 실험</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f9f9f9;
      text-align: center;
    }
    h1, h2 {
      font-weight: bold;
    }
    .image-grid {
      display: grid;
      gap: 16px;
      margin: 20px 0;
    }
    #a-options.image-grid {
      grid-template-columns: repeat(3, 1fr);
    }
    #b-options.image-grid {
      grid-template-columns: repeat(3, 1fr);
    }
    #c-options.image-grid {
      grid-template-columns: repeat(4, 1fr);
    }
    .image-grid img {
      width: 100%;
      border: 2px solid transparent;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s, border-color 0.2s;
    }
    .image-grid img:hover {
      transform: scale(1.05);
      border-color: #555;
    }
    .image-grid img.selected {
      border-color: #007bff;
    }
    .label {
      margin-top: 4px;
      font-size: 14px;
    }
    .hidden {
      display: none;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin: 4px;
    }
  </style>
</head>
<body>

  <div id="intro">
    <h1>행동경제학 실험 - 가장 좋아하는 간식</h1>
    <p>최대한 빠르지만 신중하게 선택해주세요!</p>
    <button onclick="startExperiment()">시작하기</button>
  </div>

  <div id="step-a" class="hidden">
    <p>A단계: 아래 간식 중 하나를 선택해주세요.</p>
    <div class="image-grid" id="a-options"></div>
  </div>

  <div id="step-transition" class="hidden">
    <p>버튼을 눌러주세요.</p>
    <button onclick="startStepB()">다음을 눌러 계속</button>
  </div>

  <div id="step-b" class="hidden">
    <p>B단계: 아래 간식 중 하나를 선택해주세요.</p>
    <div class="image-grid" id="b-options"></div>
  </div>

  <div id="step-transition-c" class="hidden">
    <p>버튼을 눌러주세요.</p>
    <button onclick="startStepC()">다음을 눌러 계속</button>
  </div>

  <div id="step-c" class="hidden">
    <p>C단계: 아래 간식 중 세 가지를 선택해주세요.</p>
    <div class="image-grid" id="c-options"></div>
    <button id="confirm-c" onclick="confirmC()" class="hidden">선택 완료</button>
  </div>

  <div id="satisfaction" class="hidden"></div>

  <div id="thank-you" class="hidden">
    <div id="final-results"></div>
  </div>

  <script>
    const allOptions = [
      { name: "초코파이", url: "https://img.danawa.com/prod_img/500000/974/546/img/3546974_1.jpg?_v=20250212101544" },
      { name: "포카칩", url: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT5roAyQsNk-U2SrvD7u3vfh5Cs__mSVFZm7Q&s" },
      { name: "오예스", url: "https://img.danawa.com/prod_img/500000/965/117/img/10117965_1.jpg?shrink=360:360&_v=20191210171250" },
      { name: "새우깡", url: "https://image.nongshim.com/non/pro/1594682430086.jpg" },
      { name: "고래밥", url: "https://sitem.ssgcdn.com/00/00/98/item/1000291980000_i1_750.jpg" },
      { name: "초코송이", url: "https://img.danawa.com/prod_img/500000/826/577/img/3577826_1.jpg?_v=20161108161614" },
      { name: "빼빼로", url: "https://sitem.ssgcdn.com/32/11/49/item/1000264491132_i1_750.jpg" },
      { name: "허니버터칩", url: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQqNw1r80dpzmwDTq6B3z6egCDk4WD7vVHKHQ&s" },
      { name: "콘칩", url: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR6AftGxD8wDov5Ex-87P4RodjqNhsgsBhe-w&s" },
      { name: "죠리퐁", url: "https://cphoto.asiae.co.kr/listimglink/1/2023060916485258778_1686296932.jpg" },
      { name: "포스틱", url: "https://image.nongshim.com/non/pro/product_B.jpg" },
      { name: "오감자", url: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ1w26tkveLTSGgx2beAFPAI7Ln-nLvl4Z_3A&s" },
      { name: "양파링", url: "https://img.danawa.com/prod_img/500000/086/519/img/2519086_1.jpg?_v=20161129160529" },
      { name: "나초", url: "https://static.megamart.com/product/image/0634/06341961/06341961_1_960.jpg" },
      { name: "홈런볼", url: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ0uw5bcY3H9DfTeewaDGi3l-a-gtHf4VDZJg&s" }
    ];

    let usedNames = new Set();
    let aStart, bStart, cStart;
    let aChoice, bChoice, cChoice = [];

    let satisfaction = {};

    function startExperiment() {
      document.getElementById("intro").classList.add("hidden");
      showStep("a-options", "step-a", 3, allOptions, "A", (choice) => {
        aChoice = choice;
        usedNames.add(choice);
        document.getElementById("step-a").classList.add("hidden");
        showSatisfactionStep("A", "step-transition");
      });
      aStart = Date.now();
    }

    function startStepB() {
      document.getElementById("step-transition").classList.add("hidden");
      const options = allOptions.filter(o => !usedNames.has(o.name));
      const shuffled = [...options].sort(() => 0.5 - Math.random()).slice(0, 9);
      showStep("b-options", "step-b", 3, shuffled, "B", (choice) => {
        bChoice = choice;
        usedNames.add(choice);
        document.getElementById("step-b").classList.add("hidden");
        showSatisfactionStep("B", "step-transition-c");
      });
      bStart = Date.now();
    }

    function startStepC() {
      document.getElementById("step-transition-c").classList.add("hidden");
      const options = allOptions.filter(o => !usedNames.has(o.name));
      const shuffled = [...options].sort(() => 0.5 - Math.random()).slice(0, 12);
      const container = document.getElementById("c-options");
      container.innerHTML = "";
      shuffled.forEach(option => {
        const wrapper = document.createElement("div");
        const img = document.createElement("img");
        const label = document.createElement("div");
        img.src = option.url;
        img.onclick = () => toggleC(option.name, img);
        label.className = "label";
        label.innerText = option.name;
        wrapper.appendChild(img);
        wrapper.appendChild(label);
        container.appendChild(wrapper);
      });
      document.getElementById("step-c").classList.remove("hidden");
      document.getElementById("confirm-c").classList.add("hidden");
      cStart = Date.now();
    }

    function toggleC(name, img) {
      if (img.classList.contains("selected")) {
        img.classList.remove("selected");
        cChoice = cChoice.filter(n => n !== name);
      } else {
        if (cChoice.length < 3) {
          img.classList.add("selected");
          cChoice.push(name);
        }
      }
      document.getElementById("confirm-c").classList.toggle("hidden", cChoice.length !== 3);
    }

    function confirmC() {
      const cTime = Date.now() - cStart;
      cChoice.forEach(n => usedNames.add(n));
      window._tempCData = { cChoice, cTime };
      document.getElementById("step-c").classList.add("hidden");
      showSatisfactionStep("C", "thank-you");
    }

    function showStep(containerId, stepId, cols, options, phase, callback) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      const shuffled = [...options].sort(() => 0.5 - Math.random());
      shuffled.forEach(option => {
        const wrapper = document.createElement("div");
        const img = document.createElement("img");
        const label = document.createElement("div");
        img.src = option.url;
        img.onclick = () => {
          const time = Date.now() - (phase === "A" ? aStart : bStart);
          window["_temp" + phase + "Data"] = { [phase.toLowerCase() + "Choice"]: option.name, [("time" + phase)]: time };
          callback(option.name);
        };
        label.className = "label";
        label.innerText = option.name;
        wrapper.appendChild(img);
        wrapper.appendChild(label);
        container.appendChild(wrapper);
      });
      document.getElementById(stepId).classList.remove("hidden");
    }

    function showSatisfactionStep(phase, nextStepId) {
      const container = document.getElementById("satisfaction");
      container.innerHTML = `
        <p>${phase} 단계에 얼마나 만족하셨나요? (1~5점)</p>
        <div>
          ${[1,2,3,4,5].map(score => `<button onclick="recordSatisfaction('${phase}', ${score}, '${nextStepId}')">${score}</button>`).join('')}
        </div>
      `;
      container.classList.remove("hidden");
    }

    function recordSatisfaction(phase, score, nextStepId) {
      satisfaction[phase] = score;
      document.getElementById("satisfaction").classList.add("hidden");
      if (nextStepId === "thank-you") {
        showFinalResults();
      } else {
        document.getElementById(nextStepId).classList.remove("hidden");
      }
    }

    function showFinalResults() {
      const r = document.getElementById("final-results");
      r.innerHTML = `
        <h2>감사합니다!</h2>
        <p>A단계 선택: ${_tempAData.aChoice} (시간: ${_tempAData.timeA}ms, 만족도: ${satisfaction.A})</p>
        <p>B단계 선택: ${_tempBData.bChoice} (시간: ${_tempBData.timeB}ms, 만족도: ${satisfaction.B})</p>
        <p>C단계 선택: ${_tempCData.cChoice.join(', ')} (시간: ${_tempCData.cTime}ms, 만족도: ${satisfaction.C})</p>
      `;
      document.getElementById("thank-you").classList.remove("hidden");
    }
  </script>
</body>
</html>
"""

file_path = "/mnt/data/behavioral_experiment_final.html"
with open(file_path, "w", encoding="utf-8") as f:
    f.write(html_code)

file_path
